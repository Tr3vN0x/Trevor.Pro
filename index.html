<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Blox-Sands | 2D Sandbox</title>
    <style>
        :root {
            --rbx-bg: #191b1d;
            --rbx-nav: #232527;
            --rbx-accent: #00a2ff;
        }

        body { 
            margin: 0; background: var(--rbx-bg); color: white; 
            font-family: 'Segoe UI', sans-serif; overflow: hidden; 
            display: flex; flex-direction: column; height: 100vh;
        }

        header { 
            background: var(--rbx-nav); padding: 10px 20px; 
            display: flex; justify-content: space-between; align-items: center;
            border-bottom: 2px solid #333;
        }

        .stats { color: #f3ad16; font-weight: bold; }

        #game-container {
            flex: 1; position: relative; display: flex;
            align-items: center; justify-content: center; background: #000;
        }

        canvas { 
            background: #87CEEB; /* Sky Blue */
            image-rendering: pixelated; 
            border: 4px solid #333;
        }

        .controls-hint {
            position: absolute; bottom: 20px; left: 20px;
            background: rgba(0,0,0,0.6); padding: 10px; border-radius: 5px;
            font-size: 12px; pointer-events: none;
        }
    </style>
</head>
<body>

    <header>
        <div style="font-weight: bold;">BLOX-SANDS 2D</div>
        <div class="stats">Coins: <span id="coin-count">0</span></div>
        <button onclick="location.reload()" style="background:#444; color:white; border:none; padding:5px 10px; cursor:pointer; border-radius:3px;">Reset World</button>
    </header>

    <div id="game-container">
        <canvas id="gameCanvas"></canvas>
        <div class="controls-hint">
            <b>WASD</b> to Move & Jump<br>
            <b>Left Click</b> to Mine Blocks
        </div>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const coinDisplay = document.getElementById('coin-count');

        // Game Constants
        const TILE_SIZE = 32;
        const COLS = 25;
        const ROWS = 15;
        canvas.width = COLS * TILE_SIZE;
        canvas.height = ROWS * TILE_SIZE;

        let coins = parseInt(localStorage.getItem('sandbox_coins')) || 0;
        coinDisplay.innerText = coins;

        // Tile Types
        const AIR = 0;
        const DIRT = 1;
        const GRASS = 2;
        const STONE = 3;

        const colors = {
            1: '#8B4513', // Dirt
            2: '#228B22', // Grass
            3: '#808080'  // Stone
        };

        // World Generation
        let world = [];
        for (let y = 0; y < ROWS; y++) {
            world[y] = [];
            for (let x = 0; x < COLS; x++) {
                if (y > 8) world[y][x] = (y > 11 && Math.random() > 0.7) ? STONE : DIRT;
                else if (y === 8) world[y][x] = GRASS;
                else world[y][x] = AIR;
            }
        }

        // Player Object
        const player = {
            x: 100, y: 100,
            w: 24, h: 40,
            vx: 0, vy: 0,
            speed: 4,
            jump: -10,
            gravity: 0.5,
            grounded: false,
            avatar: localStorage.getItem('rbx_avatar') || 'ðŸ‘¤'
        };

        const keys = {};
        window.onkeydown = (e) => keys[e.key.toLowerCase()] = true;
        window.onkeyup = (e) => keys[e.key.toLowerCase()] = false;

        // Mining Logic
        canvas.addEventListener('mousedown', (e) => {
            const rect = canvas.getBoundingClientRect();
            const mouseX = e.clientX - rect.left;
            const mouseY = e.clientY - rect.top;
            
            const tileX = Math.floor(mouseX / TILE_SIZE);
            const tileY = Math.floor(mouseY / TILE_SIZE);

            if (world[tileY] && world[tileY][tileX] !== AIR) {
                // Earn coins based on material
                coins += (world[tileY][tileX] === STONE) ? 5 : 1;
                world[tileY][tileX] = AIR;
                
                coinDisplay.innerText = coins;
                localStorage.setItem('sandbox_coins', coins);
            }
        });

        function update() {
            // Horizontal Movement
            if (keys['a']) player.vx = -player.speed;
            else if (keys['d']) player.vx = player.speed;
            else player.vx *= 0.8;

            // Gravity & Jump
            player.vy += player.gravity;
            if (keys['w'] && player.grounded) {
                player.vy = player.jump;
                player.grounded = false;
            }

            // Apply Velocity
            player.x += player.vx;
            player.y += player.vy;

            // Collision Detection
            player.grounded = false;
            const tileTop = Math.floor(player.y / TILE_SIZE);
            const tileBottom = Math.floor((player.y + player.h) / TILE_SIZE);
            const tileLeft = Math.floor(player.x / TILE_SIZE);
            const tileRight = Math.floor((player.x + player.w) / TILE_SIZE);

            // Simple Floor Collision
            if (world[tileBottom] && (world[tileBottom][tileLeft] !== AIR || world[tileBottom][tileRight] !== AIR)) {
                player.y = tileBottom * TILE_SIZE - player.h;
                player.vy = 0;
                player.grounded = true;
            }

            // Bound Check
            if (player.x < 0) player.x = 0;
            if (player.x > canvas.width - player.w) player.x = canvas.width - player.w;
        }

        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // Draw World
            for (let y = 0; y < ROWS; y++) {
                for (let x = 0; x < COLS; x++) {
                    const tile = world[y][x];
                    if (tile !== AIR) {
                        ctx.fillStyle = colors[tile];
                        ctx.fillRect(x * TILE_SIZE, y * TILE_SIZE, TILE_SIZE, TILE_SIZE);
                        // Subtle Border
                        ctx.strokeStyle = 'rgba(0,0,0,0.1)';
                        ctx.strokeRect(x * TILE_SIZE, y * TILE_SIZE, TILE_SIZE, TILE_SIZE);
                    }
                }
            }

            // Draw Player
            ctx.font = "30px Arial";
            ctx.fillText(player.avatar, player.x - 5, player.y + 32);
        }

        function gameLoop() {
            update();
            draw();
            requestAnimationFrame(gameLoop);
        }

        gameLoop();
    </script>
</body>
</html>
